--DB name : it485project
--id:itkstu
--password: student

--Login table query:
CREATE TABLE LOGININFO (
USERNAME VARCHAR(25) PRIMARY KEY, --USERNAME IS EMAIL ADDRESS AND IT SHOULD CONTAIN THE ADMIN DETAILS 
PASSWORD VARCHAR(20) NOT NULL,
ACCTYPE CHAR NOT NULL,
RDM_STR VARCHAR(30),
ADMIN_APPROVAL VARCHAR(1),
SECQUES VARCHAR(50),
SECANS VARCHAR(50),

);

--Faculty Profile:
CREATE TABLE FACULTYPROFILE (
USERNAME VARCHAR(25), --USERNAME IS EMAIL ADDRESS
FIRSTNAME VARCHAR(20) NOT NULL,
LASTNAME VARCHAR(20) NOT NULL,
PHONENUMBER VARCHAR(10),
CARRIER VARCHAR(15)
);

--Viewer Profile:
CREATE TABLE VIEWERPROFILE (
USERNAME VARCHAR(25), --USERNAME IS EMAIL ADDRESS
FIRSTNAME VARCHAR(20) NOT NULL,
LASTNAME VARCHAR(20) NOT NULL,
PHONENUMBER VARCHAR(10),
CARRIER VARCHAR(15)
);

--Student Profile:
CREATE TABLE STUDENTPROFILE (
USERNAME VARCHAR(25) PRIMARY KEY, --USERNAME IS EMAIL ADDRESS
FIRSTNAME VARCHAR(20) NOT NULL,
LASTNAME VARCHAR(20) NOT NULL,
PHONENUMBER VARCHAR(10),
CARRIER VARCHAR(15)
);

--User ExtraProfileSubmissionContent:
CREATE TABLE PRELIMINARY_PROJECT_SUBMISSION (
USERNAME VARCHAR(25) FOREIGN KEY REFERENCES STUDENTPROFILE (USERNAME),
PROJECT_TITLE VARCHAR(100),
COURSE_NO VARCHAR(8),
LIVE_LINK VARCHAR(100),
KEYWORDS VARCHAR(200),
ABSTRACT VARCHAR(1500),
DOCUMENT VARBINARY(MAX),
DOCUMENT_LENGTH INTEGER,
DOCUMENT_NAME VARCHAR(50),
SCREENCAST VARBINARY(MAX),
SCREENCAST_LENGTH INTEGER,
SCREENCAST_NAME VARCHAR(100),
COMMITTEE_CHAIR VARCHAR(100),
COMMITTEE_CHAIR_APPROVAL CHAR,
COMMITTEE_CHAIR_COMMENTS VARCHAR(1500),
COMMITTEE_MEMBERS VARCHAR(200),
COMMITTEE_MEMBER_APPROVAL CHAR,
COMMITTEE_MEMBER_COMMENTS VARCHAR(1500),
GRADUATE_ADVISOR VARCHAR(100),
GRADUATE_ADVISOR_APPROVAL CHAR,
GRADUATE_ADVISOR_COMMENTS VARCHAR(1500),
SEMESTER_COMPLETED VARCHAR(15),
DATE_UPLOADED DATE
);

--User Contains details for final project proposal:
CREATE TABLE FINAL_PROJECT_PROPOSAL (
USERNAME VARCHAR(25) FOREIGN KEY REFERENCES STUDENTPROFILE (USERNAME),
DOCUMENT VARBINARY(max),
DOCUMENT_LENGTH INTEGER,
DOCUMENT_NAME VARCHAR(50),
SCREENCAST VARBINARY(max),
SCREENCAST_LENGTH INTEGER,
SCREENCAST_NAME VARCHAR(100),
SEMESTER_COMPLETED VARCHAR(15),
DATE_UPLOADED DATE,
COMMITTEE_CHAIR VARCHAR(100),
COMMITTEE_CHAIR_APPROVAL CHAR,
COMMITTEE_CHAIR_COMMENTS VARCHAR(1500),
COMMITTEE_MEMBERS VARCHAR(200),
COMMITTEE_MEMBER_APPROVAL CHAR,
COMMITTEE_MEMBER_COMMENTS VARCHAR(1500),
GRADUATE_ADVISOR VARCHAR(100),
GRADUATE_ADVISOR_APPROVAL CHAR,
GRADUATE_ADVISOR_COMMENTS VARCHAR(1500)
);


--User Contains details thesis:
CREATE TABLE THESIS_SUBMISSION (
USERNAME VARCHAR(25) FOREIGN KEY REFERENCES STUDENTPROFILE (USERNAME),
COURSE_NO VARCHAR(8),
KEYWORDS VARCHAR(200),
ABSTRACT VARCHAR(1500),
DOCUMENT VARBINARY,
DOCUMENT_LENGTH INTEGER,
DOCUMENT_NAME VARCHAR(50),
SCREENCAST VARBINARY,
SCREENCAST_LENGTH INTEGER,
SCREENCAST_NAME VARCHAR(100),
COMMITTEE_CHAIR VARCHAR(100),
COMMITTEE_CHAIR_APPROVAL CHAR,
COMMITTEE_CHAIR_COMMENTS VARCHAR(1500),
COMMITTEE_MEMBERS VARCHAR(200),
COMMITTEE_MEMBER_APPROVAL CHAR,
COMMITTEE_MEMBER_COMMENTS VARCHAR(1500),
DEPARTMENT_CHAIR VARCHAR(100),
DEPARTMENT_CHAIR_APPROVAL CHAR,
DEPARTMENT_CHAIR_COMMENTS VARCHAR(1500),
SEMESTER_COMPLETED VARCHAR(15),
DATE_UPLOADED DATE
);

--Subscription
CREATE TABLE SUBSCRIPTION (
USERNAME VARCHAR(25) PRIMARY KEY,
SUBSCRIPTIONSTATUS VARCHAR(1)
);

Create  PROCEDURE spLoginInfoSignUp
(
@USERNAME VARCHAR(25),              
@password VARCHAR(20),
@accttype CHAR(1),
@rndmStr VARCHAR(30),
@adminapproval VARCHAR(1),
@secquestion VARCHAR(50),
@secanswer VARCHAR(50)
)
AS
BEGIN
INSERT INTO LOGININFO (USERNAME, PASSWORD, ACCTYPE, RDM_STR, ADMIN_APPROVAL, SECQUES, SECANS) 
VALUES ( @username, @password, @accttype, @rndmStr, @adminapproval, @secquestion, @secanswer)
END

Create  PROCEDURE spFacultyProfileSignUp
(
@USERNAME VARCHAR(25),              
@firstname VARCHAR(20),  
@lastname VARCHAR(20),
@phonenumber VARCHAR(10),
@carrier VARCHAR(15)
)
AS
BEGIN
INSERT INTO FACULTYPROFILE (USERNAME, FIRSTNAME, LASTNAME, PHONENUMBER, CARRIER) 
VALUES ( @username, @firstname, @lastname, @phonenumber, @carrier)
END

Create  PROCEDURE spStudentProfileSignUp
(
@USERNAME VARCHAR(25),              
@firstname VARCHAR(20),  
@lastname VARCHAR(20),
@phonenumber VARCHAR(10),
@carrier VARCHAR(15)
)
AS
BEGIN
INSERT INTO STUDENTPROFILE (USERNAME, FIRSTNAME, LASTNAME, PHONENUMBER, CARRIER) 
VALUES ( @username, @firstname, @lastname, @phonenumber, @carrier)
END

Create  PROCEDURE spViewerProfileSignUp
(
@USERNAME VARCHAR(25),              
@firstname VARCHAR(20),  
@lastname VARCHAR(20),
@phonenumber VARCHAR(10),
@carrier VARCHAR(15)
)
AS
BEGIN
INSERT INTO VIEWERPROFILE (USERNAME, FIRSTNAME, LASTNAME, PHONENUMBER, CARRIER) 
VALUES ( @username, @firstname, @lastname, @phonenumber, @carrier)
END

Create  PROCEDURE spThesisSubmission
(
@USERNAME VARCHAR(25)              
)
AS
BEGIN
INSERT INTO THESIS_SUBMISSION (USERNAME)
VALUES (@username)
END

Create  PROCEDURE spPreliminaryProjectSubmission
(
@USERNAME VARCHAR(25)             
)
AS
BEGIN
INSERT INTO PRELIMINARY_PROJECT_SUBMISSION (USERNAME)
VALUES (@username)
END

Create  PROCEDURE spFinalProjectProposal
(
@USERNAME VARCHAR(25)             
)
AS
BEGIN
INSERT INTO FINAL_PROJECT_PROPOSAL (USERNAME)
VALUES (@username)
END

--view to get omni search resuts without name and it needs to create OmniSearchResultsView which joins with studentProfile
CREATE VIEW omniSearchView
AS
SELECT username,document_name,'project_title' as Title,'keywoards' as keywords, date_uploaded
FROM final_project_proposal
union all
select username, document_name, project_title, keywords, date_uploaded
from preliminary_project_submission
union all
select username, document_name, title, keywords, date_uploaded
from thesis_submission;

--View to get omni search results with name
create view  OmniSearchResultsView AS
SELECT    omniSearchView.username, STUDENTPROFILE.FIRSTNAME + ' ' + STUDENTPROFILE.LASTNAME AS Name, 
omniSearchView.document_name, omniSearchView.Title, omniSearchView.keywords, 
                      omniSearchView.date_uploaded
FROM         omniSearchView INNER JOIN
                      STUDENTPROFILE ON omniSearchView.username = STUDENTPROFILE.USERNAME;

--Query for omni search that is used in the sqldatasource1		  
SELECT Name, document_name, title, keywords FROM OMNISEARCHRESULTSVIEW 
WHERE (OMNISEARCHRESULTSVIEW.DOCUMENT_NAME LIKE '%' + @Document_Name + '%') 
OR (OMNISEARCHRESULTSVIEW.Title LIKE '%' + @Title+ '%') 
or (OMNISEARCHRESULTSVIEW.keywords LIKE '%' + @Keywords+ '%')


--VIEW TO GET ALL THE COLUMNS REALTED TO STUDENT					 
CREATE VIEW SEARCHRESULTS AS
SELECT     STUDENTPROFILE.USERNAME, STUDENTPROFILE.FIRSTNAME, STUDENTPROFILE.LASTNAME, STUDENTPROFILE.PHONENUMBER, STUDENTPROFILE.CARRIER, 
                      PRELIMINARY_PROJECT_SUBMISSION.PROJECT_TITLE, 
                      PRELIMINARY_PROJECT_SUBMISSION.COURSE_NO, PRELIMINARY_PROJECT_SUBMISSION.LIVE_LINK, PRELIMINARY_PROJECT_SUBMISSION.KEYWORDS, 
                      PRELIMINARY_PROJECT_SUBMISSION.ABSTRACT, PRELIMINARY_PROJECT_SUBMISSION.[DOCUMENT], 
                      PRELIMINARY_PROJECT_SUBMISSION.DOCUMENT_LENGTH, PRELIMINARY_PROJECT_SUBMISSION.DOCUMENT_NAME, 
                      PRELIMINARY_PROJECT_SUBMISSION.SCREENCAST, PRELIMINARY_PROJECT_SUBMISSION.SCREENCAST_LENGTH, 
                      PRELIMINARY_PROJECT_SUBMISSION.SCREENCAST_NAME, PRELIMINARY_PROJECT_SUBMISSION.COMMITTEE_CHAIR, 
                      PRELIMINARY_PROJECT_SUBMISSION.COMMITTEE_CHAIR_APPROVAL, PRELIMINARY_PROJECT_SUBMISSION.COMMITTEE_CHAIR_COMMENTS, 
                      PRELIMINARY_PROJECT_SUBMISSION.COMMITTEE_MEMBERS, PRELIMINARY_PROJECT_SUBMISSION.COMMITTEE_MEMBER_APPROVAL, 
                      PRELIMINARY_PROJECT_SUBMISSION.COMMITTEE_MEMBER_COMMENTS, PRELIMINARY_PROJECT_SUBMISSION.GRADUATE_ADVISOR, 
                      PRELIMINARY_PROJECT_SUBMISSION.GRADUATE_ADVISOR_APPROVAL, PRELIMINARY_PROJECT_SUBMISSION.GRADUATE_ADVISOR_COMMENTS, 
                      PRELIMINARY_PROJECT_SUBMISSION.SEMESTER_COMPLETED, PRELIMINARY_PROJECT_SUBMISSION.DATE_UPLOADED, 
                      FINAL_PROJECT_PROPOSAL.[DOCUMENT] AS FPP_DOCUMENT, FINAL_PROJECT_PROPOSAL.DOCUMENT_NAME AS FPP_DOCUMENT_NAME, 
                      FINAL_PROJECT_PROPOSAL.SCREENCAST AS FPP_SCREENCAST, 
                      FINAL_PROJECT_PROPOSAL.SCREENCAST_NAME AS FPP_SCREENCAST_NAME, FINAL_PROJECT_PROPOSAL.DATE_UPLOADED AS FPP_DATE_UPLOADED, 
					  FINAL_PROJECT_PROPOSAL.COMMITTEE_CHAIR_APPROVAL AS FPP_COMMITTEE_CHAIR_APPROVAL, 
					  FINAL_PROJECT_PROPOSAL.COMMITTEE_CHAIR_COMMENTS AS FPP_COMMITTEE_CHAIR_COMMENTS, 
                      FINAL_PROJECT_PROPOSAL.COMMITTEE_MEMBER_APPROVAL AS FPP_COMMITTEE_MEMBER_APPROVAL, 
                      FINAL_PROJECT_PROPOSAL.COMMITTEE_MEMBER_COMMENTS AS FPP_COMMITTEE_MEMBER_COMMENTS, 
                      FINAL_PROJECT_PROPOSAL.GRADUATE_ADVISOR_APPROVAL AS FPP_GRADUATE_ADVISOR_APPROVAL,
	     FINAL_PROJECT_PROPOSAL.GRADUATE_ADVISOR_COMMENTS AS FPP_GRADUATE_ADVISOR_COMMENTS, 
                      THESIS_SUBMISSION.[DOCUMENT] AS TS_DOCUMENT, 
                     THESIS_SUBMISSION.DOCUMENT_NAME AS TS_DOCUMENT_NAME, THESIS_SUBMISSION.SCREENCAST AS TS_SCREENCAST, 
                      THESIS_SUBMISSION.SCREENCAST_NAME AS TS_SCREENCAST_NAME, 
                     THESIS_SUBMISSION.COMMITTEE_CHAIR_APPROVAL AS TS_COMMITTEE_CHAIR_APPROVAL, 
                      THESIS_SUBMISSION.COMMITTEE_CHAIR_COMMENTS AS TS_COMMITTEE_CHAIR_COMMENTS, 
                      THESIS_SUBMISSION.COMMITTEE_MEMBER_APPROVAL AS TS_COMMITTEE_MEMBER_APPROVAL, 
					  THESIS_SUBMISSION.COMMITTEE_MEMBER_COMMENTS AS TS_COMMITTEE_MEMBER_COMMENTS, 
                      THESIS_SUBMISSION.DEPARTMENT_CHAIR AS TS_DEPARTMENT_CHAIR, 
					  THESIS_SUBMISSION.DEPARTMENT_CHAIR_APPROVAL AS TS_DEPARTMENT_CHAIR_APPROVAL, 
					  THESIS_SUBMISSION.DEPARTMENT_CHAIR_COMMENTS AS TS_DEPARTMENT_CHAIR_COMMENTS, 
                      THESIS_SUBMISSION.DATE_UPLOADED AS TS_DATE_UPLOADED
FROM         STUDENTPROFILE INNER JOIN
                      PRELIMINARY_PROJECT_SUBMISSION ON STUDENTPROFILE.USERNAME = PRELIMINARY_PROJECT_SUBMISSION.USERNAME INNER JOIN
                      FINAL_PROJECT_PROPOSAL ON PRELIMINARY_PROJECT_SUBMISSION.USERNAME = FINAL_PROJECT_PROPOSAL.USERNAME INNER JOIN
                      THESIS_SUBMISSION ON FINAL_PROJECT_PROPOSAL.USERNAME = THESIS_SUBMISSION.USERNAME